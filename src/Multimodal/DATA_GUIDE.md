# æ•°æ®å‡†å¤‡æŒ‡å— - å›¾åƒ-æ–‡æœ¬å¯¹æ•°æ®

## ğŸ“Š æ•°æ®æ ¼å¼è¦æ±‚

è¿™ä¸ªå¤šæ¨¡æ€CLIPè®­ç»ƒé¡¹ç›®æ”¯æŒä¸¤ç§ä¸»è¦çš„æ•°æ®æ ¼å¼ï¼š

### æ ¼å¼1ï¼šJSONç´¢å¼•æ–‡ä»¶ï¼ˆæ¨èï¼‰

åˆ›å»ºä¸€ä¸ª `data.json` æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å›¾åƒ-æ–‡æœ¬å¯¹çš„ç´¢å¼•ï¼š

```json
[
  {
    "image_path": "images/cat_001.jpg",
    "caption": "ä¸€åªæ©˜è‰²çš„çŒ«ååœ¨çª—å°ä¸Šï¼Œé˜³å…‰æ´’åœ¨å®ƒçš„æ¯›å‘ä¸Š"
  },
  {
    "image_path": "images/dog_002.jpg", 
    "caption": "ä¸€åªé‡‘æ¯›çŠ¬åœ¨å…¬å›­é‡Œå¥”è·‘ï¼ŒèƒŒæ™¯æ˜¯ç»¿è‰²çš„è‰åœ°"
  },
  {
    "image_path": "images/sunset_003.jpg",
    "caption": "ç¾ä¸½çš„æ—¥è½æ™¯è‰²ï¼Œå¤©ç©ºå‘ˆç°æ©™çº¢è‰²ï¼Œæµ·é¢æ³¢å…‰ç²¼ç²¼"
  }
]
```

### æ ¼å¼2ï¼šç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ image_001.jpg
â”‚   â”œâ”€â”€ image_002.jpg
â”‚   â””â”€â”€ image_003.jpg
â””â”€â”€ captions/
    â”œâ”€â”€ image_001.txt
    â”œâ”€â”€ image_002.txt
    â””â”€â”€ image_003.txt
```

æ¯ä¸ªtxtæ–‡ä»¶åŒ…å«å¯¹åº”å›¾åƒçš„æ–‡æœ¬æè¿°ã€‚

## ğŸ–¼ï¸ å›¾åƒè¦æ±‚

### åŸºæœ¬è¦æ±‚
- **æ ¼å¼**: JPG, PNG, JPEG (æ¨èJPG)
- **å°ºå¯¸**: ä»»æ„å°ºå¯¸ (ç¨‹åºä¼šè‡ªåŠ¨resizeåˆ°224Ã—224)
- **é¢œè‰²**: RGBå½©è‰²å›¾åƒ (ç°åº¦å›¾ä¼šè‡ªåŠ¨è½¬ä¸ºRGB)
- **è´¨é‡**: å»ºè®®æ¸…æ™°ã€æ— æŸçš„å›¾åƒ

### æ¨èè§„æ ¼
- **åˆ†è¾¨ç‡**: 256Ã—256ä»¥ä¸Š (é¿å…è¿‡åº¦å‹ç¼©)
- **æ–‡ä»¶å¤§å°**: æ¯å¼ 100KB-2MB
- **æ•°é‡**: æœ€å°‘50å¯¹ï¼Œæ¨è1000+å¯¹ç”¨äºæœ‰æ•ˆè®­ç»ƒ

### å›¾åƒå†…å®¹å»ºè®®
- **å¤šæ ·æ€§**: åŒ…å«ä¸åŒåœºæ™¯ã€ç‰©ä½“ã€äººç‰©
- **æ¸…æ™°åº¦**: ä¸»ä½“æ˜ç¡®ï¼ŒèƒŒæ™¯ä¸è¦è¿‡äºå¤æ‚
- **è´¨é‡**: å…‰çº¿è‰¯å¥½ï¼Œè‰²å½©è‡ªç„¶

## ğŸ“ æ–‡æœ¬è¦æ±‚

### æè¿°å†…å®¹
- **å‡†ç¡®æ€§**: å‡†ç¡®æè¿°å›¾åƒä¸­çš„ä¸»è¦å†…å®¹
- **è¯¦ç»†ç¨‹åº¦**: åŒ…å«ä¸»ä½“ã€åŠ¨ä½œã€èƒŒæ™¯ã€é¢œè‰²ç­‰ä¿¡æ¯
- **é•¿åº¦**: å»ºè®®10-50ä¸ªè¯ï¼Œä¸è¶…è¿‡77ä¸ªtoken

### æ–‡æœ¬ç¤ºä¾‹

**å¥½çš„æè¿°**ï¼š
```
"ä¸€åªé»‘ç™½ç›¸é—´çš„çŒ«å’ªèººåœ¨çº¢è‰²æ²™å‘ä¸Šï¼Œæ—è¾¹æœ‰ä¸€ä¸ªè“è‰²çš„æŠ±æ•"
"ä¸¤ä¸ªå°æœ‹å‹åœ¨æµ·è¾¹ç©æ²™å­ï¼ŒèƒŒæ™¯æ˜¯è”šè“çš„å¤§æµ·å’Œç™½äº‘"
"ç°ä»£ç®€çº¦é£æ ¼çš„å®¢å…ï¼Œç™½è‰²å¢™å£ï¼Œæœ¨è´¨èŒ¶å‡ ä¸Šæ”¾ç€ç»¿è‰²æ¤ç‰©"
```

**é¿å…çš„æè¿°**ï¼š
```
"è¿™æ˜¯ä¸€å¼ å›¾ç‰‡"  # å¤ªç®€å•
"å¤æ‚çš„å®¤å†…åœºæ™¯åŒ…å«äº†å„ç§å®¶å…·è£…é¥°å“ä»¥åŠå¤šä¸ªäººç‰©åœ¨è¿›è¡Œä¸åŒçš„æ´»åŠ¨..." # å¤ªå¤æ‚
"cat sofa"  # å¤ªç®€çŸ­
```

## ğŸ“ æ•°æ®ç»„ç»‡ç¤ºä¾‹

è®©æˆ‘ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ•°æ®ç»„ç»‡ç¤ºä¾‹ï¼š

### ç¤ºä¾‹1ï¼šå® ç‰©æ•°æ®é›†
```json
[
  {
    "image_path": "images/pets/cat_sleeping.jpg",
    "caption": "ä¸€åªç°è‰²çš„çŒ«å’ªèœ·ç¼©åœ¨æ¯›æ¯¯ä¸Šç¡è§‰"
  },
  {
    "image_path": "images/pets/dog_playing.jpg",
    "caption": "ä¸€åªæ‹‰å¸ƒæ‹‰å¤šçŠ¬åœ¨è‰åœ°ä¸Šç©é£ç›˜"
  },
  {
    "image_path": "images/pets/rabbit_eating.jpg",
    "caption": "ç™½è‰²çš„å…”å­åœ¨åƒèƒ¡èåœï¼Œååœ¨ç»¿è‰²çš„è‰åœ°ä¸Š"
  }
]
```

### ç¤ºä¾‹2ï¼šé£æ™¯æ•°æ®é›†
```json
[
  {
    "image_path": "images/landscapes/mountain_lake.jpg",
    "caption": "é›ªå±±å€’æ˜ åœ¨æ¸…æ¾ˆçš„æ¹–æ°´ä¸­ï¼Œå‘¨å›´æ˜¯èŒ‚å¯†çš„æ£®æ—"
  },
  {
    "image_path": "images/landscapes/beach_sunset.jpg",
    "caption": "é‡‘è‰²çš„å¤•é˜³æ´’åœ¨æ²™æ»©ä¸Šï¼Œæµ·æµªè½»æŸ”åœ°æ‹æ‰“ç€å²¸è¾¹"
  },
  {
    "image_path": "images/landscapes/city_night.jpg",
    "caption": "åŸå¸‚å¤œæ™¯ï¼Œé«˜æ¥¼å¤§å¦ç¯ç«é€šæ˜ï¼Œè¡—é“ä¸Šè½¦æµå¦‚ç»‡"
  }
]
```

## ğŸ”¨ æ•°æ®å‡†å¤‡å·¥å…·

### è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹æ•°æ®
å¦‚æœæ‚¨æš‚æ—¶æ²¡æœ‰å‡†å¤‡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨é¡¹ç›®å†…ç½®çš„ç¤ºä¾‹æ•°æ®ç”ŸæˆåŠŸèƒ½ï¼š

```python
from data_loader import create_sample_dataset

# ç”Ÿæˆ100ä¸ªç¤ºä¾‹æ ·æœ¬
create_sample_dataset("./data", num_samples=100)
```

### éªŒè¯æ•°æ®æ ¼å¼
```python
from data_loader import ImageTextDataset

# æµ‹è¯•æ•°æ®åŠ è½½
dataset = ImageTextDataset("./data")
print(f"æ•°æ®é›†å¤§å°: {len(dataset)}")

# æŸ¥çœ‹ç¬¬ä¸€ä¸ªæ ·æœ¬
image, text = dataset[0]
print(f"å›¾åƒå½¢çŠ¶: {image.shape}")
print(f"æ–‡æœ¬å½¢çŠ¶: {text.shape}")
```

## ğŸ“‹ æ•°æ®è´¨é‡æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹è®­ç»ƒå‰ï¼Œè¯·ç¡®ä¿ï¼š

### âœ… æ–‡ä»¶ç»“æ„æ£€æŸ¥
- [ ] data.jsonæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- [ ] æ‰€æœ‰å›¾åƒæ–‡ä»¶è·¯å¾„æ­£ç¡®
- [ ] å›¾åƒæ–‡ä»¶å¯ä»¥æ­£å¸¸æ‰“å¼€
- [ ] æ–‡æœ¬æè¿°ä¸ä¸ºç©º

### âœ… å†…å®¹è´¨é‡æ£€æŸ¥
- [ ] å›¾åƒ-æ–‡æœ¬å¯¹åº”å…³ç³»æ­£ç¡®
- [ ] æ–‡æœ¬æè¿°å‡†ç¡®ä¸”æœ‰æ„ä¹‰
- [ ] æ•°æ®é‡è¶³å¤Ÿï¼ˆæ¨è>100å¯¹ï¼‰
- [ ] å†…å®¹å¤šæ ·æ€§è¶³å¤Ÿ

### âœ… æŠ€æœ¯è§„æ ¼æ£€æŸ¥
- [ ] å›¾åƒæ ¼å¼æ”¯æŒï¼ˆJPG/PNGï¼‰
- [ ] æ–‡æœ¬ç¼–ç ä¸ºUTF-8
- [ ] æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç›¸å¯¹è·¯å¾„
- [ ] ç‰¹æ®Šå­—ç¬¦æ­£ç¡®å¤„ç†

## ğŸ¯ ä¸åŒé¢†åŸŸçš„æ•°æ®å»ºè®®

### 1. ç”µå•†äº§å“
```json
{
  "image_path": "products/shoes_nike_001.jpg",
  "caption": "Nikeç™½è‰²è¿åŠ¨é‹ï¼Œé»‘è‰²å‹¾æ ‡ï¼Œé€‚åˆè·‘æ­¥å’Œæ—¥å¸¸ç©¿ç€"
}
```

### 2. åŒ»å­¦å½±åƒ
```json
{
  "image_path": "medical/xray_chest_001.jpg", 
  "caption": "èƒ¸éƒ¨Xå…‰ç‰‡æ˜¾ç¤ºæ­£å¸¸çš„è‚ºéƒ¨ç»“æ„ï¼Œå¿ƒè„å¤§å°æ­£å¸¸"
}
```

### 3. è‰ºæœ¯ä½œå“
```json
{
  "image_path": "art/painting_001.jpg",
  "caption": "å°è±¡æ´¾é£æ ¼çš„é£æ™¯ç”»ï¼Œæç»˜äº†æ˜¥å¤©çš„èŠ±å›­ï¼Œè‰²å½©é²œæ˜"
}
```

### 4. é£Ÿç‰©å›¾ç‰‡
```json
{
  "image_path": "food/pizza_001.jpg",
  "caption": "æ„å¤§åˆ©ç›æ ¼ä¸½ç‰¹æŠ«è¨ï¼Œä¸Šé¢æœ‰æ–°é²œç½—å‹’å¶å’Œé©¬è‹é‡Œæ‹‰å¥¶é…ª"
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹æ­¥éª¤

1. **åˆ›å»ºæ•°æ®ç›®å½•ç»“æ„**ï¼š
```bash
mkdir -p data/images
mkdir -p data/captions
```

2. **æ”¾ç½®å›¾åƒæ–‡ä»¶**ï¼š
å°†æ‚¨çš„å›¾åƒæ–‡ä»¶å¤åˆ¶åˆ° `data/images/` ç›®å½•

3. **åˆ›å»ºæ–‡æœ¬æè¿°**ï¼š
- æ–¹å¼1ï¼šåˆ›å»º `data/data.json` æ–‡ä»¶
- æ–¹å¼2ï¼šåœ¨ `data/captions/` ç›®å½•åˆ›å»ºå¯¹åº”çš„txtæ–‡ä»¶

4. **éªŒè¯æ•°æ®**ï¼š
```bash
python3 -c "from data_loader import ImageTextDataset; d=ImageTextDataset('./data'); print(f'åŠ è½½äº†{len(d)}ä¸ªæ ·æœ¬')"
```

5. **å¼€å§‹è®­ç»ƒ**ï¼š
```bash
python3 train.py
```

## ğŸ’¡ æ•°æ®å‡†å¤‡æŠ€å·§

### 1. æ‰¹é‡å¤„ç†å›¾åƒ
```python
from PIL import Image
import os

def resize_images(input_dir, output_dir, size=(512, 512)):
    for filename in os.listdir(input_dir):
        if filename.lower().endswith(('.jpg', '.jpeg', '.png')):
            img = Image.open(os.path.join(input_dir, filename))
            img = img.resize(size, Image.Resampling.LANCZOS)
            img.save(os.path.join(output_dir, filename))
```

### 2. æ‰¹é‡ç”Ÿæˆæè¿°æ¨¡æ¿
```python
def generate_caption_template(image_name):
    # æ ¹æ®å›¾åƒæ–‡ä»¶åç”ŸæˆåŸºç¡€æè¿°æ¨¡æ¿
    base_name = os.path.splitext(image_name)[0]
    return f"è¿™æ˜¯ä¸€å¼ å…³äº{base_name}çš„å›¾ç‰‡"
```

### 3. æ•°æ®å¢å¼º
```python
# å¯ä»¥é€šè¿‡åŒä¸€å¼ å›¾ç‰‡ç”Ÿæˆå¤šä¸ªä¸åŒè§’åº¦çš„æè¿°
captions = [
    "ä¸€åªçŒ«ååœ¨çª—å°ä¸Š",
    "çª—å°ä¸Šæœ‰ä¸€åªå¯çˆ±çš„çŒ«å’ª", 
    "é˜³å…‰é€è¿‡çª—æˆ·ç…§å°„åœ¨çŒ«å’ªèº«ä¸Š"
]
```

## ğŸ› ï¸ æ•°æ®å‡†å¤‡å·¥å…·

é¡¹ç›®æä¾›äº†å¤šä¸ªå·¥å…·å¸®åŠ©æ‚¨å‡†å¤‡æ•°æ®ï¼š

### 1. ç¤ºä¾‹æ•°æ®ç”Ÿæˆå™¨
```bash
# ç”Ÿæˆç¤ºä¾‹æ•°æ®ç”¨äºæµ‹è¯•
python3 prepare_data_example.py
```

### 2. æ•°æ®æ ¼å¼è½¬æ¢å™¨
```bash
# ä»CSVæ–‡ä»¶è½¬æ¢
python3 convert_data.py --format csv --input your_data.csv

# ä»æ–‡ä»¶å¤¹ç»“æ„è½¬æ¢  
python3 convert_data.py --format folder --input ./your_images --captions-dir ./your_captions

# ä»COCOæ ¼å¼è½¬æ¢
python3 convert_data.py --format coco --input annotations.json --images-dir ./images
```

### 3. æ•°æ®éªŒè¯å·¥å…·
```bash
# éªŒè¯æ•°æ®å®Œæ•´æ€§
python3 example_data/validate_data.py
```

## ğŸ“ å‡†å¤‡æ­¥éª¤æ€»ç»“

1. **é€‰æ‹©æ•°æ®æ¥æº**ï¼š
   - è‡ªå·±æ‹æ‘„/æ”¶é›†å›¾åƒ
   - ä½¿ç”¨å…¬å¼€æ•°æ®é›†
   - ç½‘ç»œçˆ¬è™«æ”¶é›†ï¼ˆæ³¨æ„ç‰ˆæƒï¼‰

2. **æ•´ç†æ•°æ®æ ¼å¼**ï¼š
   - ä½¿ç”¨æä¾›çš„è½¬æ¢å·¥å…·
   - æ‰‹åŠ¨åˆ›å»ºJSONæ–‡ä»¶
   - æŒ‰ç›®å½•ç»“æ„ç»„ç»‡

3. **è´¨é‡æ£€æŸ¥**ï¼š
   - å›¾åƒæ¸…æ™°åº¦æ£€æŸ¥
   - æ–‡æœ¬æè¿°å‡†ç¡®æ€§
   - æ•°æ®å®Œæ•´æ€§éªŒè¯

4. **å¼€å§‹è®­ç»ƒ**ï¼š
   - æ•°æ®é‡ï¼šæœ€å°‘50å¯¹ï¼Œæ¨è1000+
   - è¿è¡Œï¼š`python3 train.py --data_dir your_data_dir`

## ğŸ¯ å¸¸è§æ•°æ®æ¥æº

- **å…¬å¼€æ•°æ®é›†**ï¼šCOCO, Flickr30k, Conceptual Captions
- **ç”µå•†æ•°æ®**ï¼šäº§å“å›¾ç‰‡+æè¿°
- **ç¤¾äº¤åª’ä½“**ï¼šå›¾ç‰‡+æ ‡é¢˜/è¯„è®º
- **ä¸“ä¸šé¢†åŸŸ**ï¼šåŒ»å­¦å½±åƒ+æŠ¥å‘Šï¼Œå«æ˜Ÿå›¾åƒ+æ ‡æ³¨

ç°åœ¨æ‚¨å¯ä»¥æ ¹æ®è¿™ä¸ªæŒ‡å—å‡†å¤‡æ‚¨çš„å›¾åƒ-æ–‡æœ¬å¯¹æ•°æ®äº†ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å¯ä»¥è¯¢é—®ã€‚
